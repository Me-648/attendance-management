<div class="admin-container">
  <header class="admin-header">
    <h1>出席管理アプリ</h1>
    <div class="logout-link">
      <%= link_to "ログアウト", destroy_user_session_path, data: { turbo_method: :delete } %>
    </div>
  </header>

  <main class="attendance-list-main">
    <% if @period && @date %>
      <div class="date-info">
        <%= @date.strftime("%Y年%m月%d日") %> <%= @period.weekday_ja %>曜日 <%= @period.period_number %>コマ
        <% if @enrollment_year.present? %>
          <%= @enrollment_year %>年度入学生
        <% end %>
      </div>
      
      <!-- 警告メッセージ -->
      <% if flash[:notice] %>
        <div class="notice-message">
          <%= flash[:notice] %>
        </div>
      <% end %>
      
      <div class="stats">
        出席：<%= @attended_count %>名　
        欠席：<%= @absent_count %>名　
        未記録：<%= @unrecorded_count %>名
      </div>

      <!-- 変更: ここから -->
      <div class="attendance-grid">
        <% @students.each do |student| %>
          <% attendance = @attendances[student.id] %>
          <% 
            # 状態を判定
            if attendance.nil?
              cell_class = 'unrecorded'
              status_text = '未記録'
              is_clickable = false
            elsif attendance.status == 'absent'
              cell_class = 'absent'
              status_text = '欠席'
              is_clickable = true  # 欠席者のみクリック可能
            elsif attendance.status == 'late'
              cell_class = 'late'
              status_text = '遅刻'
              is_clickable = false
            elsif attendance.status == 'officially_absent'
              cell_class = 'officially-absent'
              status_text = '公欠'
              is_clickable = false
            else
              cell_class = 'attended'
              status_text = '出席'
              is_clickable = false
            end
          %>
          
          <% if is_clickable %>
            <%= link_to admin_absence_reason_path(attendance.id), class: "student-cell-link" do %>
              <div class="student-cell <%= cell_class %>">
                <div class="student-name"><%= student.name %></div>
                <small class="status-label">(<%= status_text %>)</small>
              </div>
            <% end %>
          <% else %>
            <div class="student-cell <%= cell_class %>">
              <div class="student-name"><%= student.name %></div>
              <small class="status-label">(<%= status_text %>)</small>
            </div>
          <% end %>
        <% end %>
      </div>
      <!-- 変更: ここまで -->

      <div class="back-link">
        <%= link_to "← 戻る", admin_root_path %>
      </div>
    <% else %>
      <% if flash[:alert] %>
        <p class="alert"><%= flash[:alert] %></p>
      <% end %>
      <div class="back-link">
        <%= link_to "← 戻る", admin_root_path %>
      </div>
    <% end %>
  </main>
</div>

<style>
  .admin-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    font-family: sans-serif;
  }

  .admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
  }

  .admin-header h1 {
    font-size: 24px;
    margin: 0;
  }

  .logout-link a {
    color: #333;
    text-decoration: none;
  }

  .attendance-list-main {
    background-color: #fff;
  }

  .date-info {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 10px;
  }

  /* 警告メッセージ */
  .notice-message {
    padding: 15px;
    background-color: #fff3cd;
    border: 1px solid #ffc107;
    border-radius: 4px;
    margin-bottom: 20px;
    color: #856404;
    font-size: 14px;
  }

  .stats {
    font-size: 16px;
    margin-bottom: 20px;
  }

  .attendance-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0;
    border: 1px solid #ccc;
    margin-bottom: 20px;
  }

  .student-cell {
    border: 1px solid #ccc;
    padding: 15px 10px;
    text-align: center;
    font-size: 14px;
    transition: background-color 0.2s;  /* 変更: アニメーション追加 */
  }

  .student-name {
    font-weight: 500;
    margin-bottom: 4px;
  }

  .status-label {
    display: block;
    font-size: 11px;
    opacity: 0.8;
  }

  /* 出席（白背景） */
  .student-cell.attended {
    background-color: white;
    color: #333;
  }

  /* 欠席（赤背景） */
  .student-cell.absent {
    background-color: #cc6666;
    color: white;
  }

  /* 遅刻（黄色背景） */
  .student-cell.late {
    background-color: #f0ad4e;
    color: white;
  }

  /* 公欠（青背景） */
  .student-cell.officially-absent {
    background-color: #5bc0de;
    color: white;
  }

  /* 未記録（グレー背景） */
  .student-cell.unrecorded {
    background-color: #e0e0e0;
    color: #666;
  }

  /* 変更: リンク用のスタイルを追加 */
  .student-cell-link {
    text-decoration: none;
    color: inherit;
    display: block;
  }
  
  .student-cell-link:hover .student-cell.absent {
    background-color: #b35555;
    cursor: pointer;
  }

  .back-link {
    margin-top: 20px;
  }

  .back-link a {
    color: #0066cc;
    text-decoration: none;
  }

  .back-link a:hover {
    text-decoration: underline;
  }

  .alert {
    padding: 15px;
    background-color: #ffebee;
    border: 1px solid #f44336;
    border-radius: 4px;
    margin-bottom: 20px;
    color: #c62828;
  }
</style>