<%= turbo_frame_tag "search_result" do %>
  <section class="admin-results">
    <div class="admin-results__header">
      <h3 class="admin-results__title">
        <%= @attendances.year %>年<%= @attendances.month %>月<%= @attendances.day %>日
        <%= @attendances.period.period_number %>コマ目
        <%= @attendances.enrollment_year %>年度入学生
      </h3>
      <% stats = attendance_stats(@attendances) %>
      <p class="admin-results__summary">出席：<%= stats[:attended] %>名　欠席：<%= stats[:absent] %>名</p>
      <% if stats[:unrecorded] > 0 %>
        <p class="admin-results__notice">※ <%= stats[:unrecorded] %>名の出席データが未記録です</p>
      <% end %>
    </div>
  
    <div class="admin-periods">
    
    <%# 金曜 (wday = 5) は2コマ、それ以外は3コマ %>
    <% max_period = (@attendances.date.wday == 5 ? 2 : 3) %>
  
    <%# 1〜max_period までボタン生成 %>
    <% (1..max_period).each do |period_num| %>
      <%= link_to "#{period_num}コマ目",
          admin_attendances_by_period_path(
          year: @attendances.year,
          month: @attendances.month,
          day: @attendances.day,
          enrollment_year: @attendances.enrollment_year,
          period: period_num
        ),
        class: "admin-period #{@attendances.period_number == period_num ? 'active' : ''}",
        data: { turbo_frame: "search_result" } %>
      <% end %>
    </div>
  
  
    <div class="admin-attendance-grid">
      <% @attendances.students.each do |student| %>
        <% attendance = @attendances.attendances[student.id] %>
        <div class="admin-attendance-card <%= attendance&.status %>">
          <% unless attendance&.status_attended? || attendance.blank? %>
            <%= link_to student.name, admin_attendance_reason_path(attendance.id), data: { turbo_frame: "_top" }, class: "admin-attendance-card__link" %>
          <% else %>
            <span class="admin-attendance-card__name"><%= student.name %></span>
          <% end %>
        </div>
      <% end %>
    </div>
  </section>
<% end %>
