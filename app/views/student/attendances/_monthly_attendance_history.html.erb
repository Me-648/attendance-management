<div class="bg-container shadow rounded-lg p-6 h-full border-none">
  <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
    <h3 class="text-md font-bold text-gray-800">出席一覧</h3>
    
    <!-- 検索フォーム (GET) -->
    <%= form_with url: student_attendances_path, method: :get, class: "flex items-center space-x-2 text-sm bg-container p-0" do |f| %>
      <%= f.select :year, (Date.current.year-1..Date.current.year+1).to_a, { selected: facade.year }, class: "w-auto min-w-[5rem] px-2 py-1 text-sm bg-[#C4C4C4] rounded text-gray-700 font-medium border-none focus:ring-brown cursor-pointer" %>
      <span class="text-gray-600">年</span>
      
      <%= f.select :month, (1..12).to_a, { selected: facade.month }, class: "w-auto min-w-[3rem] px-2 py-1 text-sm bg-[#C4C4C4] rounded text-gray-700 font-medium border-none focus:ring-brown cursor-pointer" %>
      <span class="text-gray-600">月</span>
      
      <%= f.submit "検索", class: "ml-2 bg-[#C4C4C4] text-gray-700 px-4 py-1.5 rounded hover:bg-gray-400 cursor-pointer transition-colors text-sm font-medium" %>
    <% end %>
  </div>

  <div class="overflow-x-auto rounded border border-brown">
    <table class="w-full text-sm text-center border-collapse">
      <thead class="bg-brown text-white font-bold">
        <tr>
          <th class="border-b border-white/20 p-3 whitespace-nowrap min-w-[100px] border-r border-white/20 last:border-r-0">日付</th>
          <% (1..3).each do |num| %>
            <th class="border-b border-white/20 p-3 whitespace-nowrap min-w-[80px] border-r border-white/20 last:border-r-0"><%= num %>コマ</th>
          <% end %>
        </tr>
      </thead>
      <tbody class="divide-y divide-brown bg-container">
        <% if facade.monthly_attendances.present? %>
          <% facade.monthly_attendances.each_with_index do |(date, daily_data), index| %>
            <tr class="<%= index.even? ? 'bg-brand-ivory' : 'bg-container' %> transition-colors border-b border-brown last:border-b-0">
              <td class="p-3 text-gray-700 font-medium whitespace-nowrap border-r border-brown"><%= l(date, format: "%Y/%m/%d") %></td>
              <% (1..3).each do |num| %>
                <td class="p-3 border-r border-brown last:border-r-0">
                  <% att = daily_data[num] %>
                  <% if att %>
                    <% 
                      # バッジ形式 (画像に合わせてシンプル化も検討)
                      status_sym = att.status.to_sym
                      base_classes = "inline-block px-3 py-1 rounded text-white font-medium text-xs w-[60px]"
                      
                      badge_class = case status_sym
                      when :attended then "bg-attended"
                      when :absent then "bg-absent"
                      when :late then "bg-late" # late text is usually darker, but image shows yellow/orange bg
                      when :officially_absent then "bg-officially-absent"
                      else "bg-gray-400"
                      end
                    %>

                    <% if status_sym == :attended %>
                      <span class="<%= base_classes %> <%= badge_class %>">
                        <%= attendance_label(att.status) %>
                      </span>
                    <% else %>
                      <%= link_to attendance_label(att.status), student_attendance_path(att),
                          class: "#{base_classes} #{badge_class} hover:opacity-75 transition-opacity cursor-pointer block mx-auto",
                          data: { turbo_frame: "modal" }
                      %>
                    <% end %>
                  <% else %>
                    <span class="text-gray-400">-</span>
                  <% end %>
                </td>
              <% end %>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="4" class="p-8 text-gray-400">データがありません</td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
