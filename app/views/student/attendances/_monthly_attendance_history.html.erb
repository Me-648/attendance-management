<div class="bg-white shadow rounded-lg p-6 h-full border border-gray-100">
  <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
    <h3 class="text-md font-bold text-gray-800">出席一覧</h3>
    
    <!-- 検索フォーム (GET) -->
    <%= form_with url: student_attendances_path, method: :get, class: "flex items-center space-x-2 text-sm bg-gray-50 p-2 rounded-lg" do |f| %>
      <%= f.select :year, (Date.current.year-1..Date.current.year+1).to_a, { selected: facade.year }, class: "w-auto min-w-[5rem] px-2 py-1 text-sm border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 bg-white cursor-pointer" %>
      <span class="text-gray-600">年</span>
      
      <%= f.select :month, (1..12).to_a, { selected: facade.month }, class: "w-auto min-w-[4rem] px-2 py-1 text-sm border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 bg-white cursor-pointer" %>
      <span class="text-gray-600">月</span>
      
      <%= f.submit "検索", class: "ml-2 bg-gray-600 text-white px-4 py-1.5 rounded-md hover:bg-gray-700 cursor-pointer transition-colors text-xs font-bold uppercase tracking-wider" %>
    <% end %>
  </div>

  <div class="overflow-x-auto rounded-lg border border-gray-200">
    <table class="w-full text-sm text-center border-collapse">
      <thead class="bg-gray-50 text-gray-700 font-medium">
        <tr>
          <th class="border-b border-gray-200 p-3 whitespace-nowrap min-w-[100px]">日付</th>
          <% (1..3).each do |num| # 画像に合わせて3コマ分表示するが、実際はfacadeから取得 %>
            <th class="border-b border-gray-200 p-3 whitespace-nowrap min-w-[80px]"><%= num %>コマ</th>
          <% end %>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200 bg-white">
        <% if facade.monthly_attendances.present? %>
          <% facade.monthly_attendances.each do |date, daily_data| %>
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="p-3 text-gray-600 font-medium whitespace-nowrap"><%= l(date, format: "%Y/%m/%d") %></td>
              <% (1..3).each do |num| %>
                <td class="p-3">
                  <% att = daily_data[num] %>
                  <% if att %>
                    <% 
                      # バッジスタイルの定義 (BEMクラス使用)
                      status_sym = att.status.to_sym
                      badge_classes = "attendance-badge"
                      
                      case status_sym
                      when :attended
                        badge_classes += " text-attended-dark border-attended-dark bg-attended-bg"
                      when :absent
                        badge_classes += " bg-absent text-white border-absent"
                      when :late
                        badge_classes += " text-late-dark border-late-dark bg-late-bg"
                      when :officially_absent
                        badge_classes += " text-officially-absent-dark border-officially-absent-dark bg-officially-absent-bg"
                      end
                    %>

                    <% if status_sym == :attended %>
                      <span class="<%= badge_classes %>">
                        <%= attendance_label(att.status) %>
                      </span>
                    <% else %>
                      <%= link_to attendance_label(att.status), student_attendance_path(att),
                          class: "#{badge_classes} hover:opacity-75 transition-opacity cursor-pointer block",
                          data: { turbo_frame: "modal" }
                      %>
                    <% end %>
                  <% else %>
                    <span class="attendance-badge text-neutral border-neutral-border">-</span>
                  <% end %>
                </td>
              <% end %>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="4" class="p-8 text-gray-400">データがありません</td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
