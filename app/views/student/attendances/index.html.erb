<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1><%= @today.strftime("%Y年%m月%d日") %> の時間割</h1>
    <span>ようこそ、<%= current_user.name %> さん</span>
  </div>

  <% if @periods.any? %>
    <div class="list-group">
      <% @periods.each do |period| %>
        <%
          attendance = @attendances[period.id]
        %>
        <div class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <h5 class="mb-1"><%= period.period_number %>限目</h5>
            <p class="mb-1 text-muted">
              授業開始: <%= period.start_time.strftime('%H:%M') %> /
              出席受付: <%= (period.start_time - 5.minutes).strftime('%H:%M') %> ~ <%= period.start_time.strftime('%H:%M') %>
            </p>
          </div>

          <div>
            <% unless attendance %>
              <%# 出欠が登録済みの場合 %>
              <span class="badge bg-success fs-6"></span>
              <% if period.reception_active? %>
                <%# 受付時間内の場合 %>
                <%= form_with(model: Attendance.new, url: student_attendances_path, method: :post) do |f| %>
                  <%= f.hidden_field :period_id, value: period.id %>
                  <%= f.hidden_field :status, value: :attended %>
                  <%= f.submit "出席する", class: "btn btn-primary" %>
                <% end %>

                <%= form_with(model: Attendance.new, url: student_attendances_path, method: :post) do |f| %>
                  <%= f.hidden_field :period_id, value: period.id %>
                  <%= f.hidden_field :status, value: :absent %>
                  <%= f.submit "欠席する", class: "btn btn-primary" %>
                <% end %>
                
              <% else %>
                <%= form_with(model: Attendance.new, url: student_attendances_path, method: :post) do |f| %>
                  <%= f.hidden_field :period_id, value: period.id %>
                  <%= f.hidden_field :status, value: :absent %>
                  <%= f.submit "欠席する", class: "btn btn-primary" %>
                <% end %>
              <% end %>
            <% else %>
            <%# 受付時間外の場合 %>
                <span class="badge bg-secondary fs-6">受付時間外</span>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="alert alert-info">本日の授業はありません。</div>
  <% end %>
</div>